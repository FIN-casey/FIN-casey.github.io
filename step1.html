<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>FB-Osmose Bridge</title>
<link rel="stylesheet" href="screen.css" type="text/css">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script src="funcWizard.js"></script>
<script src="underscore-min.js" type="text/javascript"></script>
<script type="text/javascript">
//$(document).ready(function () {
var ecosystemCount = 0;
var ecosystem = ['https://fishbase.ropensci.org/ecosystem?limit=5000'];

$.ajax({
	type: 'GET',
	url: "ecosystem.json",
	success: function (result) {
		
		$.each(result, function(index, element){
			$('#ecosystem').append($('<option>', {
				text: element.EcosystemName,
				value: element.E_CODE + ""
			}));
		});
		
	},
	error: function(XMLHttpRequest, textStatus, errorThrown) {
		alert(textStatus);
	}
});

$.ajax({
	type: 'GET',
	url: "https://fishbase.ropensci.org/countref?limit=500&fields=C_Code,Note",
	success: function (result) {
		
		//get unique
		//var eName = _.keys(_.countBy(result.data, function(data) {return data.C_Code+'|'+data.Note; }));
		
		var byCountry = result.data.slice(0);
		byCountry.sort(function(a,b){
			var x = a.Note.toLowerCase();
			var y = b.Note.toLowerCase();
			return x < y ? -1 : x > y ? 1 : 0;
		});
		
		$.each(byCountry, function(index, element){
			
			$('#country').append($('<option>', {
				text: element.Note,
				value: "" + element.C_Code
			}));
		});
		
	},
	error: function(XMLHttpRequest, textStatus, errorThrown) {
		alert(textStatus);
	}
});

function listSubCountry(){
	var c_code = document.getElementById("country").value;

	$('#subcountry').empty();
	$('#subcountry').append($('<option>', {
		text: "Select",
		value: "none"
	}));
	
	$('#faoarea').empty();
	$('#faoarea').append($('<option>', {
		text: "Select",
		value: "none"
	}));
	
	if(c_code!= "none"){
		$.ajax({
		type: 'GET',
		url: "subcountry.json",
		async:false,
		success: function (result) {
			
			var filter = $.grep(result, function(element,index){
				return element.C_Code == c_code;
			});
			
			$.each(filter, function(index, element){
				$('#subcountry').append($('<option>', {
					text: element.CountrySub,
					value: element.CSub_Code
				}));
			});
		},
		error: function(XMLHttpRequest, textStatus, errorThrown) {
			alert(textStatus);
		}
		});
		
		$.ajax({
		type: 'GET',
		url: "faoarea.json",
		async:false,
		success: function (result) {

			var filter = $.grep(result, function(element,index){
				return element.C_Code == c_code;
			});
			
			$.each(filter, function(index, element){
				$('#faoarea').append($('<option>', {
					text: element.FAO,
					value: element.AreaCode
				}));
			});
		},
		error: function(XMLHttpRequest, textStatus, errorThrown) {
			alert(textStatus);
		}
		});
	}
}

//});
</script>
</head>
<body>

	<div class="pheader">Step 1: Getting parameter estimates for your OSMOSE model</div>
	<div id="container">
		<p class="justify13">You are about to query parameter estimates for your OSMOSE model.</p>

		<p class="justify13">To get started, please select an ecosystem or a combination of a country and FAO area.</p>
		
		<form action="step2.html" method="get" id="step1Form">
		
		<div id="selectecosystem">
			<div class="floatLeft width5">
				<input type="radio" name="choose" value="eco" checked onchange="changeEcoOrCountry()"></input>
			</div>
			<div class="padTop10" id="ecoDiv">
				<div class="w200 floatLeft">
					 <b><i>Ecosystem</i></b> 
				</div>
				<select name="ecosystem" id="ecosystem">
					<option value="none" selected="selected">Select</option>
				</select>
			</div>
		</div>
			<hr>
		<div id="selectcountry">
			<div class="floatLeft width5">
				<input type="radio" name="choose" value="cntry" onchange="changeEcoOrCountry()"></input>
			</div>
			<div class="overflow-hidden" id="countryDiv">
				<div class="padTop10">
					<div class="w200 floatLeft">
						 <b><i>Country</i></b> 
					</div>
					<select name="country" id="country" onchange="listSubCountry()" disabled>
						<option value="none">Select</option>
					</select>
				</div>
				<div class="padTop10">
					<div class="w200 floatLeft">
						 <b><i>Sub-country</i></b> 
					</div>
					<select name="subcountry" id="subcountry" disabled>
						<option value="none" selected="selected">Select</option>
					</select>
				</div>
				<div class="padTop10">
					<div class="w200 floatLeft">
						 <b><i>FAO Area</i></b> 
					</div>
					<select name="faoarea" id="faoarea" disabled>
						<option value="none" selected>Select</option>
					</select>
				</div>
			</div>
		</div>
		
		<div class="padTop10">
			<input type="submit" name="submit" value="Proceed"/>
			
			<input type="button" name="exit" value="Exit" onClick="parent.location='step1.html'"></input>
		</div>
		</form>
	</div>
	
	<div id="locid"></div>
	
	<script type="text/javascript">
	
	/*(function($){

		var Item = Backbone.Model.extend();

		var List = Backbone.Collection.extend({
			model: Item,
			url:"https://fishbase.ropensci.org/ecosystem?limit=10"
		  });    

		var ListView = Backbone.View.extend({    
			el: $('#test'),
			events: {
			  //'click button#add': 'getPost'
			},
			initialize: function(){
			  _.bindAll(this, 'render', 'getPost');
			  this.collection = new List();
			  this.render(); 
			},
			render: function(){
			  var self = this;      
			  $(this.el).append("<button id='add'>get</button>");
			},
			getPost: function(){
			  console.log(this.collection.fetch());
			}

		});

	  // **listView instance**: Instantiate main app view.
	  var listView = new ListView();      
	})(jQuery);?*/
	
	</script>
</body>
</html>